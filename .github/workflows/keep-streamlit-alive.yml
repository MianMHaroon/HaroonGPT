name: Keep Streamlit App Alive

on:
  schedule:
    - cron: "0 * * * *"   # Every hour at minute 0
  workflow_dispatch:       # Manual trigger option

jobs:
  wake-streamlit:
    runs-on: ubuntu-latest
    timeout-minutes: 8
    
    steps:
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - name: Cache Playwright browsers
        id: playwright-cache
        uses: actions/cache@v4
        with:
          path: ~/.cache/ms-playwright
          key: playwright-${{ runner.os }}-v1
          restore-keys: |
            playwright-${{ runner.os }}-
          
      - name: Install Playwright
        run: |
          pip install playwright==1.45.0
          
      - name: Install Chromium (first time - with dependencies)
        if: steps.playwright-cache.outputs.cache-hit != 'true'
        run: |
          playwright install chromium --with-deps
          
      - name: Install Chromium (cached - browser only)
        if: steps.playwright-cache.outputs.cache-hit == 'true'
        run: |
          playwright install chromium
          
      - name: Wake Streamlit App
        run: |
          python - <<'EOF'
          from playwright.sync_api import sync_playwright
          import time
          
          url = "https://haroongpt.streamlit.app/"
          
          print(f"ðŸŒ Navigating to {url}")
          
          with sync_playwright() as p:
              browser = p.chromium.launch(headless=True)
              context = browser.new_context(
                  viewport={'width': 1920, 'height': 1080},
                  user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
              )
              page = context.new_page()
              
              # Navigate and wait for network to be idle
              page.goto(url, wait_until='networkidle', timeout=90000)
              
              print("â³ Staying on page for 60 seconds...")
              
              # Simulate user activity every 15 seconds
              for i in range(4):
                  page.wait_for_timeout(15000)  # 15 seconds
                  try:
                      # Move mouse to simulate activity
                      page.mouse.move(100 + (i * 200), 100 + (i * 150))
                      print(f"  âœ“ Activity at {(i+1)*15} seconds")
                  except Exception as e:
                      print(f"  âš  Mouse movement warning: {e}")
              
              print("âœ… Successfully kept Streamlit app alive for 60 seconds")
              browser.close()
          EOF
